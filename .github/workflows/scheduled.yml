name: Daily Update

on:
  push:
    branches:
      - master
  schedule:
    # triggers at 2:50 AM IST (9:20 PM UTC)
    - cron: '20 21 * * *'

permissions:
  contents: write
  pull-requests: write # crucial for creating PRs

jobs:
  update_master:
    runs-on: ubuntu-latest
    steps:
      # Step 1: checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: fetch Git user 
      - name: Set git user from secret
        run: |
          echo "username=${{ secrets.USERNAME }}" >> $GITHUB_ENV
          echo "email=${{ secrets.EMAIL }}" >> $GITHUB_ENV

      # Step 3: set up Git user configuration
      - name: Set git user
        run: |
          git config --global user.name "$USERNAME"
          git config --global user.email "$EMAIL"

      # Step 4: fetch latest changes 
      - name: Fetch latest changes
        run: git fetch origin master

      # Step 5: checkout to master branch 
      - name: Checkout master branch
        run: git checkout master

      # Step 6: add current IST and UTC time in update_log.md file  
      - name: Update update_log.md
        run: |
          echo "" > update_log.md  # Clear previous content
          echo "# auto-updated at $(TZ='Asia/Kolkata' date +'%Y-%m-%d %H:%M:%S IST')" >> update_log.md
          echo "# auto-updated at $(TZ='UTC' date +'%Y-%m-%d %H:%M:%S UTC')" >> update_log.md

      # Step 7: add update_log.md file and commit it  
      - name: Add and commit changes
        run: |
          git add update_log.md
          git commit -m "Corrected typo in error message for invalid password"

      # Step 8: push the latest changes
      - name: Push changes to master
        run: git push origin master
